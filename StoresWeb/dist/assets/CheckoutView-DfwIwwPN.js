import{u as E,i as U,s as T,f as q,b as i,a as t,t as s,e,k as D,w as F,l as M,v as d,x as m,y as N,F as P,d as v,r as I,h as b,p as h,z as R,o as c,q as A}from"./index-ChIn5XDW.js";import{u as B}from"./checkout-Bx8ORkuP.js";import{a as O}from"./stores-CPvMirkz.js";import{f as j}from"./currency-jolHBzHh.js";const z={class:"animate-fade-in max-w-2xl mx-auto"},G={class:"text-2xl font-bold text-gray-900 mb-6"},H={key:0,class:"card p-8 text-center"},$={class:"text-gray-600"},J={class:"card p-6 space-y-4"},K={class:"font-semibold text-gray-900"},Q={class:"block text-sm font-medium text-gray-700 mb-1"},W={class:"block text-sm font-medium text-gray-700 mb-1"},X={class:"block text-sm font-medium text-gray-700 mb-1"},Y={class:"block text-sm font-medium text-gray-700 mb-1"},Z={class:"block text-sm font-medium text-gray-700 mb-1"},ee={value:"pickup"},te={value:"delivery"},oe=["disabled"],se={key:0},re={key:1},le={key:0,class:"mt-1 text-sm text-green-600"},ne={key:1,class:"mt-1 text-sm text-red-600"},ae={class:"block text-sm font-medium text-gray-700 mb-1"},ie={class:"block text-sm font-medium text-gray-700 mb-1"},ce={class:"card p-6"},ue={class:"text-gray-600"},de={class:"text-2xl font-bold text-gray-900 mt-1"},me={key:0,class:"rounded-xl bg-red-50 border border-red-200 p-4 text-red-700 text-sm"},pe=["disabled"],he={__name:"CheckoutView",setup(ye){const x=R(),{t:r}=E(),u=U(),p=T(),o=B(),f=b(!1),_=b(null),y=b(!1),k=h(()=>{var l;return((l=u.storeCurrency)==null?void 0:l.currency_code)||"USD"}),g=h(()=>{var l;return((l=u.storeCurrency)==null?void 0:l.currency_symbol_position)||"before"});function w(l){return j(l,k.value,g.value)}function C(){o.form.order_type!=="delivery"&&o.setLocationError(null)}function L(){if(!navigator.geolocation){o.setLocationError("Geolocation is not supported");return}y.value=!0,o.setLocationError(null),navigator.geolocation.getCurrentPosition(l=>{o.setDeliveryLocation(l.coords.latitude,l.coords.longitude),y.value=!1},l=>{o.setLocationError(l.message||r("common.error")),y.value=!1},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}q(async()=>{if(p.customer&&o.setForm({name:p.customer.name||"",email:p.customer.email||"",phone:p.customer.phone||"",address:p.customer.address||""}),u.storeId)try{const l=await O(u.storeId);u.setStoreCurrency(l)}catch{}});async function V(){if(o.form.order_type==="delivery"&&(o.deliveryLat==null||o.deliveryLng==null)){_.value=r("checkout.locationRequired");return}_.value=null,f.value=!0;try{await x.push({name:"PlaceOrder"})}finally{f.value=!1}}return(l,n)=>{const S=I("router-link");return c(),i("div",z,[t("h1",G,s(e(r)("checkout.title")),1),e(u).isEmpty?(c(),i("div",H,[t("p",$,s(e(r)("cart.empty")),1),D(S,{to:"/",class:"btn-primary inline-block mt-4"},{default:F(()=>[A(s(e(r)("cart.continueShopping")),1)]),_:1})])):(c(),i("form",{key:1,class:"space-y-6",onSubmit:M(V,["prevent"])},[t("div",J,[t("h2",K,s(e(r)("checkout.customerDetails")),1),t("div",null,[t("label",Q,s(e(r)("checkout.name"))+" *",1),d(t("input",{"onUpdate:modelValue":n[0]||(n[0]=a=>e(o).form.name=a),type:"text",required:"",class:"input-field"},null,512),[[m,e(o).form.name]])]),t("div",null,[t("label",W,s(e(r)("checkout.email")),1),d(t("input",{"onUpdate:modelValue":n[1]||(n[1]=a=>e(o).form.email=a),type:"email",class:"input-field"},null,512),[[m,e(o).form.email]])]),t("div",null,[t("label",X,s(e(r)("checkout.phone"))+" *",1),d(t("input",{"onUpdate:modelValue":n[2]||(n[2]=a=>e(o).form.phone=a),type:"tel",required:"",class:"input-field"},null,512),[[m,e(o).form.phone]])]),t("div",null,[t("label",Y,s(e(r)("checkout.address")),1),d(t("input",{"onUpdate:modelValue":n[3]||(n[3]=a=>e(o).form.address=a),type:"text",class:"input-field"},null,512),[[m,e(o).form.address]])]),t("div",null,[t("label",Z,s(e(r)("checkout.orderType")),1),d(t("select",{"onUpdate:modelValue":n[4]||(n[4]=a=>e(o).form.order_type=a),class:"input-field",onChange:C},[t("option",ee,s(e(r)("checkout.pickup")),1),t("option",te,s(e(r)("checkout.delivery")),1)],544),[[N,e(o).form.order_type]])]),e(o).form.order_type==="delivery"?(c(),i(P,{key:0},[t("div",null,[t("button",{type:"button",class:"btn-secondary w-full flex items-center justify-center gap-2",disabled:y.value,onClick:L},[y.value?(c(),i("span",se,s(e(r)("common.loading")),1)):(c(),i("span",re,"ðŸ“ "+s(e(r)("checkout.useMyLocation")),1))],8,oe),e(o).deliveryLat!=null?(c(),i("p",le," âœ“ "+s(e(o).deliveryLat.toFixed(5))+", "+s(e(o).deliveryLng.toFixed(5)),1)):v("",!0),e(o).locationError?(c(),i("p",ne,s(e(o).locationError),1)):v("",!0)]),t("div",null,[t("label",ae,s(e(r)("checkout.deliveryInstructions")),1),d(t("textarea",{"onUpdate:modelValue":n[5]||(n[5]=a=>e(o).form.delivery_instructions=a),rows:"2",class:"input-field"},null,512),[[m,e(o).form.delivery_instructions]])])],64)):v("",!0),t("div",null,[t("label",ie,s(e(r)("checkout.orderNotes")),1),d(t("textarea",{"onUpdate:modelValue":n[6]||(n[6]=a=>e(o).form.notes=a),rows:"2",class:"input-field"},null,512),[[m,e(o).form.notes]])])]),t("div",ce,[t("p",ue,s(e(r)("cart.subtotal")),1),t("p",de,s(w(e(u).subtotal)),1)]),_.value?(c(),i("div",me,s(_.value),1)):v("",!0),t("button",{type:"submit",class:"btn-primary w-full py-3 text-lg",disabled:f.value},s(f.value?e(r)("common.loading"):e(r)("checkout.proceedToReview")),9,pe)],32))])}}};export{he as default};

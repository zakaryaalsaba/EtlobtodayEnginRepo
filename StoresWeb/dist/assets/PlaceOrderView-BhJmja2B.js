import{u as O,i as N,s as V,f as D,b as c,a as r,t as o,e as t,k as g,w as k,d as u,h,r as F,p,z as P,o as d,q as C}from"./index-ChIn5XDW.js";import{u as j}from"./checkout-Bx8ORkuP.js";import{c as B}from"./orders-BgEV0kvS.js";import{a as E}from"./stores-CPvMirkz.js";import{f as A}from"./currency-jolHBzHh.js";const T={class:"animate-fade-in max-w-2xl mx-auto"},q={class:"text-2xl font-bold text-gray-900 mb-6"},z={key:0,class:"card p-8 text-center"},M={class:"text-gray-600"},R={key:1,class:"space-y-6"},U={class:"card p-6"},W={class:"font-semibold text-gray-900 mb-3"},$={class:"text-gray-700"},G={class:"text-gray-600 text-sm"},H={key:0,class:"text-gray-600 text-sm"},J={key:1,class:"text-gray-600 text-sm mt-1"},K={key:2,class:"text-gray-500 text-xs mt-1"},Q={key:0,class:"card p-6"},X={class:"font-semibold text-gray-900 mb-2"},Y={class:"text-gray-600"},Z={class:"card p-6"},ee={class:"font-semibold text-gray-900 mb-3"},te={class:"card p-6"},re={class:"font-semibold text-gray-900 mb-3"},oe={class:"space-y-2"},se={class:"flex justify-between text-gray-700"},ae={key:0,class:"flex justify-between text-gray-700"},le={class:"flex justify-between text-lg font-bold text-gray-900 pt-2 border-t"},ne={key:1,class:"rounded-xl bg-red-50 border border-red-200 p-4 text-red-700 text-sm"},ce={class:"flex gap-3"},de=["disabled"],fe={__name:"PlaceOrderView",setup(ie){const w=P(),{t:l}=O(),n=N(),x=V(),e=j(),i=h(null),_=h(!1),m=h(null),S=p(()=>{var a,s;return((a=i.value)==null?void 0:a.currency_code)||((s=n.storeCurrency)==null?void 0:s.currency_code)||"USD"}),I=p(()=>{var a,s;return((a=i.value)==null?void 0:a.currency_symbol_position)||((s=n.storeCurrency)==null?void 0:s.currency_symbol_position)||"before"}),f=p(()=>{var a;return e.form.order_type!=="delivery"||!((a=i.value)!=null&&a.delivery_fee)?0:Number(i.value.delivery_fee)||0}),b=p(()=>n.subtotal+(f.value||0));function v(a){return A(a,S.value,I.value)}D(async()=>{if(n.storeId)try{i.value=await E(n.storeId),n.setStoreCurrency(i.value)}catch{}});async function L(){var a;if(!n.storeId){m.value=l("common.error");return}_.value=!0,m.value=null;try{const s={website_id:n.storeId,customer_id:x.isLoggedIn?x.customer.id:null,customer_name:e.form.name,customer_email:e.form.email||null,customer_phone:e.form.phone,customer_address:e.form.address||null,order_type:e.form.order_type,payment_method:"cash",items:n.getItemsForOrder(),notes:e.form.notes||null,delivery_instructions:e.form.order_type==="delivery"&&e.form.delivery_instructions||null,total_amount:b.value};e.form.order_type==="delivery"&&e.deliveryLat!=null&&e.deliveryLng!=null&&(s.delivery_latitude=e.deliveryLat,s.delivery_longitude=e.deliveryLng);const y=await B(s);n.clearCart(),e.reset(),await w.replace({name:"OrderTrack",params:{orderNumber:y.order_number}})}catch(s){m.value=((a=s.body)==null?void 0:a.error)||s.message||l("common.error")}finally{_.value=!1}}return(a,s)=>{const y=F("router-link");return d(),c("div",T,[r("h1",q,o(t(l)("checkout.placeOrder")),1),t(n).isEmpty?(d(),c("div",z,[r("p",M,o(t(l)("cart.empty")),1),g(y,{to:"/",class:"btn-primary inline-block mt-4"},{default:k(()=>[C(o(t(l)("cart.continueShopping")),1)]),_:1})])):(d(),c("div",R,[r("div",U,[r("h2",W,o(t(l)("checkout.customerDetails")),1),r("p",$,o(t(e).form.name),1),r("p",G,o(t(e).form.phone),1),t(e).form.email?(d(),c("p",H,o(t(e).form.email),1)):u("",!0),t(e).form.address?(d(),c("p",J,o(t(e).form.address),1)):u("",!0),t(e).form.order_type==="delivery"&&t(e).deliveryLat!=null?(d(),c("p",K," ðŸ“ "+o(t(e).deliveryLat.toFixed(5))+", "+o(t(e).deliveryLng.toFixed(5)),1)):u("",!0)]),t(e).form.order_type==="delivery"&&t(e).form.delivery_instructions?(d(),c("div",Q,[r("h2",X,o(t(l)("checkout.deliveryInstructions")),1),r("p",Y,o(t(e).form.delivery_instructions),1)])):u("",!0),r("div",Z,[r("h2",ee,o(t(l)("checkout.payWith")),1),s[0]||(s[0]=r("p",{class:"text-gray-700"},"Cash",-1))]),r("div",te,[r("h2",re,o(t(l)("checkout.paymentSummary")),1),r("div",oe,[r("div",se,[r("span",null,o(t(l)("cart.subtotal")),1),r("span",null,o(v(t(n).subtotal)),1)]),t(e).form.order_type==="delivery"&&f.value>0?(d(),c("div",ae,[s[1]||(s[1]=r("span",null,"Delivery",-1)),r("span",null,o(v(f.value)),1)])):u("",!0),r("div",le,[r("span",null,o(t(l)("common.total")),1),r("span",null,o(v(b.value)),1)])])]),m.value?(d(),c("div",ne,o(m.value),1)):u("",!0),r("div",ce,[g(y,{to:"/checkout",class:"btn-secondary flex-1 text-center py-3"},{default:k(()=>[C(o(t(l)("common.back")),1)]),_:1}),r("button",{type:"button",class:"btn-primary flex-1 py-3",disabled:_.value,onClick:L},o(_.value?t(l)("common.loading"):t(l)("checkout.placeOrder")),9,de)])]))])}}};export{fe as default};
